---
title: "TSA: Forecasting Competition"
author: "Hannah Schofield & Sebrina Zu"
output: pdf_document
always_allow_html: true
editor_options: 
  chunk_output_type: console
  markdown: 
    wrap: sentence
---
```{r package, message=FALSE, warning=FALSE}
library(lubridate)
library(ggplot2)
library(forecast)  
library(Kendall)
library(tseries)
library(outliers)
library(tidyverse)
library(smooth)
library(zoo)
library(kableExtra)
```

```{r}
#Loading data
library(readxl)
load <- read_excel("Competition/Data/load.xlsx")
relative_humidity <- read_excel("Competition/Data/relative_humidity.xlsx")
temperature<-read_excel("Competition/Data/temperature.xlsx")
```

```{r}
#convert hourly to daily averages 
load_daily <- load %>% 
  mutate(daily_average=rowMeans(load[,3:26]))  %>% 
  select(date, daily_average)

```

```{r}
par(mfrow=c(1,2))
ACF_Plot <- Acf(load_daily$daily_average, lag = 40, plot = TRUE,main="")
PACF_Plot <- Pacf(load_daily$daily_average, lag = 40, plot = TRUE,main="")
par(mfrow=c(1,1))

```

```{r} 
#convert to time series 
ts_avgDaily <- msts(load_daily$daily_average, 
                           seasonal.periods =c(7,365.25),
                           start=c(2005,01,01))


```

```{r}
n_for = 365
ts_avgDaily_train <- subset(ts_avgDaily,end = length(ts_avgDaily)-n_for)

ts_avgDaily_test <- subset(ts_avgDaily,end = length(ts_avgDaily)-n_for)

autoplot(ts_avgDaily_train)
autoplot(ts_avgDaily_test)

```

```{r ETS}
ETS_fit <-  stlf(ts_avgDaily_train,h=365)

#Plot foresting results
autoplot(ETS_fit) + ylab("Load")

#Plot model + observed data
autoplot(ts_avgDaily) +
  autolayer(ETS_fit, series="STL + ETS",PI=FALSE) +
  ylab("Load")
```

```{r}

ARIMA_Four_fit <- auto.arima(ts_avgDaily_train, 
                             seasonal=FALSE, 
                             lambda=0,
                             xreg=fourier(ts_avgDaily_train, 
                                          K=c(2,12))
                             )

#Forecast with ARIMA fit
#also need to specify h for fourier terms
ARIMA_Four_for <- forecast(ARIMA_Four_fit,
                           xreg=fourier(ts_avgDaily_train,
                                        K=c(2,12),
                                        h=365),
                           h=365
                           ) 

#Plot foresting results
autoplot(ARIMA_Four_for) + ylab("Load")

#Plot model + observed data
autoplot(ts_avgDaily) +
  autolayer(ARIMA_Four_for, series="ARIMA_FOURIER",PI=FALSE) +
  ylab("Load")

```

```{r}
#NN_fit <- nnetar(ts_act_power_daily_train,p=1,P=1)
NN_fit <- nnetar(ts_avgDaily_train,p=1,P=0,xreg=fourier(ts_avgDaily_train, K=c(2,12)))

#NN_for <- forecast(NN_fit, h=365) 
NN_for <- forecast(NN_fit, h=365,xreg=fourier(ts_avgDaily_train, 
                                          K=c(2,12),h=365))

#Plot foresting results
autoplot(NN_for) +
  ylab("Load") 

#Plot model + observed data
autoplot(ts_avgDaily) +
  autolayer(NN_for, series="Neural Network",PI=FALSE)+
  ylab("Load") 


```

```{r}
#Model 1: STL + ETS
ETS_scores <- accuracy(ETS_fit$mean,ts_avgDaily_test)  

#Model 2: ARIMA + Fourier 
ARIMA_scores <- accuracy.default(ARIMA_Four_for$mean,ts_avgDaily_test)

# Model 3:  Neural Network 
NN_scores <- accuracy(NN_for$mean,ts_avgDaily_test)


```
